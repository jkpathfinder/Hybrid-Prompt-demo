# Hybrid Prompt

<p>
    <a href="https://www.python.org/">
        <img alt="Build" src="https://img.shields.io/badge/Python-3.7+-1f425f.svg?color=purple">
    </a>
</p>

## File Structure

### code
***A simple executable demo for generating php webshell samples.***

1. **ploy.py:** File for generating plots of experimental data.
2. **extra_module.py:** File that stores the hierarchial module in the Hybrid Prompt algorithm.
3. **gpt.py:** File that calling OpenAI's GPT api in streaming format. Contain functions for different stages such as ***Generate*** and ***Vote***.
4. **~~gpt_test.py~~:** File for testing GPT api in streaming format, deprecated.
5. **jsp_MD5hash.py:** Filter file for jsp webshell.
6. **parser.py:** File for command line interaction.
7. **php_MD5hash.py:** Filter file for php webshell.
8. **php_prompt.py:** Prompt file for the Hybrid Prompt algorithm.
9. **php_run.py:** The main executable file of the Hybrid Prompt algorithm.
10. **setting.py:** Parameter files for Hybrid Prompt.
11. **tools.py:** Tool files contain tool functions for Hybrid Prompt.
12. **vt_check.py:** File that calling VIRUSTOTAL's api to check the obfuscated file.

### data
***Note: The dataset for the Hybrid Prompt algorithm is not disclosed here for security considerations, but the dataset can be obtained from the authors upon reasonable request.***

1. **original dataset:** Original webshell samples collected from multiple sources.
2. **MD5filter dataset:** Webshell samples after MD5 Hash filtering.
3. **obfuscate dataset:** Obfuscated samples generated by Hybrid Prompt algorithm.
4. **template dataset:** Initial template code for feeding LLM models for triple filtering.
5. **Example dataset:** Few-shot Example code for different modules in Hybrid Prompt algorithm.



### result
***Folder used to store the VIRUSTOTAL detection engine testing reports. Including both .json and .txt formats.***

## Usage
1. Setup your own OpenAI API environment in file **setting.py**.
2. Install all the required environments by the following command:
   ```bash
   pip install -r requirements.txt
   ```
3. Run the Hybrid Prompt algorithm with the following command:
   ```bash
   python php_run.py one.php --choices "Add unrelated comments"
   ```
   "one.php" can be replaced by other template files, "Add unrelated comments" can be replaced by other modules. For more functional parameters, see the **parser.py** file.
4. Evaluate the performance of generated obfuscate samples by running:
   ```bash
   python vt_check.py
   ```
   The results can then be viewed in the "result" folder.

## Extension
Extending the functionality of Hybrid Prompt algorithm is very simple and mainly consists of the following steps:
* Add new module name in file **extra_module.py**
* Add the corresponding Few-shot Example in folder **Example dataset**.
  
## Citation
Please cite the paper and star this repo if you use Hybrid Prompt and find it useful, thanks!

```bibtex
```
